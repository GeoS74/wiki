# Использование официальных образов

Примеры использования некоторых официальных [[Image - образы Docker|образов Docker]].

### Node
Если просто запустить контейнер на основе образа Node, то он после запуска тут же завершиться, т.к. у него нет команд для выполнения. Но, можно запустить контейнер  [[NodeJS]] в интерактивном режиме (REPL).
Запуск контейнера в интерактивном режиме на основе образа Node:
```bash
sudo docker run -it node
```

### PostgreSQL

Если [[Контейнеры Docker|контейнер]]  образа [[PostgreSQL]] пробрасывает порт наружу `-p 5432:5432`, то такой контейнер будет доступен скриптам хост системы по `localhost:5432`. Если порты не пробрасываются, но при этом [[Контейнеры Docker|контейнер]] запущен с указанием `--network`, то такой контейнер будет доступен по дефолтным или указанным при создании контейнера портам только другим контейнерам, включенным в эту же [[Сети Docker контейнеров|сеть контейнеров]].

>Обязательно указать пароль `POSTGRES_PASSWORD` для доступа к БД. Это единственный обязательный параметр.


По умолчанию [[PostgreSQL]] работает на порту `5432`, если на локальной машине уже запущен сервер PostgreSQL, и надо использовать именно этот порт, то локальный сервер надо [[Управление сервером PostgreSQL|остановить]]. 
```bash
# запуск контейнера
sudo docker run --rm -d -p 5432:5432 --name testdb -e POSTGRES_PASSWORD=secretpass postgres

# подключение к контейнеру
sudo docker exec -it postgres bash

# подключение к БД
psql -U postgres -h localhost
```

>Прим.: команда подключения к БД внутри контейнера несколько отличается от той, которая используется на локальной машине. В случае подключения к БД на локальной машине, сначала надо сменить пользователя на `postgres`, а затем подключаться. После подключения к контейнеру PostgreSQL (если я правильно понимаю) подключение по умолчанию выполняется под пользователем `postgres`, следовательно можно сразу подключаться к БД

Пример запуска контейнера [[PostgreSQL]] и запуск другого контейнера с подключением к первому, используя [[Подключение к psql|psql]].

```bash
# создать сеть
sudo docker network create darknet

# запуск первого контейнера
sudo docker run --rm -d --name db -e POSTGRES_PASSWORD=admin --network darknet postgres

# запуск второго контейнера с psql
sudo docker run -it --rm --network darknet postgres psql -h db -U postgres
```

##### Инициализация БД и внешнее хранилище

Пример запуска [[Image - образы Docker|образа]] Postgres с начальной инициализацией .sql скриптом и общим хранилище фалов базы данных.

>Если вы хотите выполнить дополнительную инициализацию в образе, полученном из этого, добавьте один или несколько `*.sql`, `*.sql.gz`, или же `*.sh`скрипты под `/docker-entrypoint-initdb.d`

```bash
mkdir ./db
touch ./db/init.sql
# разрешить запуск скриптов
chmod ugo+x ./db/init.sql
```

Файл init.sql:
```sql
create database books;
```

Создание контейнера, [[файл Makefile]]:
```Makefile
rundb:
	docker run \
	--rm -d \
	--network mynetwork \
	-p 5435:5432 \
	--name db \
	-e POSTGRES_PASSWORD=admin \
	-v /home/geos/nodejs/delme/db:/docker-entrypoint-initdb.d \
	-v /home/geos/nodejs/delme/data:/var/lib/postgresql/data \
	postgres
```

### MongoDB

В официальной документации к образу [[MongoDB]] указаны не совсем работающие интсрукции. Вот рабочий пример запуска контейнера MongoDB и запуск другого контейнера с подключением к первому, используя [[MongoDB shell (mongosh)]]. Cм. также [[Запуск mongosh|использование флагов mongosh]].

```bash
# создать сеть
sudo docker network create darknet

# запуск первого контейнера
sudo docker run -d --rm --name db --network darknet mongo

# запуск второго контейнера с mongosh
sudo docker run -it --rm --network darknet mongo mongosh --host db
```

При запуске второго контейнера, в качестве хоста для mongosh указывается имя первого контейнера.

