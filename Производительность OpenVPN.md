# Производительность OpenVPN

Для VPS с 1 ГБ RAM и OpenVPN вот подробный анализ:

## **Теоретические и практические лимиты**

### **Основные ограничивающие факторы:**

#### **1. Память (самое критичное)**

- **На процесс:** ~15-25 МБ на подключение (в среднем)
    
- **Буферы шифрования:** дополнительные 5-10 МБ
    
- **Таблицы маршрутизации:** 1-2 МБ на клиента
    

#### **2. CPU (шифрование)**

- AES-256 шифрование: ~5-10% CPU на ядро на клиента
    
- 1 ядро VPS: 10-15 клиентов максимум
    

#### **3. Пропускная способность**

- 1 Гбит/с VPS: ~100 Мбит/с реально для VPN
    
- На клиента: 2-10 Мбит/с в среднем
    

## **Расчетные цифры**

### **Оптимистичный сценарий:**

text

1 ГБ RAM = 1024 МБ
Система: 300 МБ
OpenVPN сервер: 100 МБ
Остаток: 624 МБ

На клиента: 20 МБ
Максимум: 624 / 20 ≈ 31 клиент

### **Реалистичный сценарий:**

- **10-15 клиентов** — стабильная работа
    
- **20 клиентов** — возможны замедления
    
- **25+ клиентов** — серьезные проблемы
    

### **Критические точки замедления:**

#### **При 5-8 клиентах:**

- Нет заметного замедления
    
- Ping: 20-40 мс
    
- Скорость: 80-90% от канала
    

#### **При 10-15 клиентах:**

- Начинается swapping (если нет SSD)
    
- Ping: 50-100 мс
    
- Скорость падает на 20-30%
    

#### **При 20+ клиентах:**

- Массовый swapping → лаги
    
- Ping: 150-500 мс
    
- Speedtest: < 10 Мбит/с
    
- Возможны разрывы соединений
    

## **Оптимизация для максимума клиентов**

### **Конфигурация OpenVPN (`server.conf`):**

ini

# 1. Уменьшить буферы
sndbuf 0
rcvbuf 0
push "sndbuf 0"
push "rcvbuf 0"

# 2. Использовать менее ресурсоемкое шифрование
cipher AES-128-GCM
auth SHA256

# 3. Отключить лишнее
comp-lzo no
mute 10
verb 1

# 4. Оптимизировать таймауты
keepalive 30 120
persist-tun
persist-key

# 5. TUN вместо TAP
dev tun

### **Настройки ОС (Ubuntu/Debian):**

bash

# Увеличить лимиты
echo "net.core.rmem_max = 134217728" >> /etc/sysctl.conf
echo "net.core.wmem_max = 134217728" >> /etc/sysctl.conf
echo "net.ipv4.tcp_rmem = 4096 87380 134217728" >> /etc/sysctl.conf
echo "net.ipv4.tcp_wmem = 4096 65536 134217728" >> /etc/sysctl.conf
sysctl -p

# Swappiness для SSD
echo "vm.swappiness = 10" >> /etc/sysctl.conf

### **Мониторинг нагрузки:**

bash

# Память на клиента
sudo ps -eo pid,ppid,cmd,%mem,%cpu --sort=-%mem | grep openvpn

# Общая нагрузка
htop
free -h

## **Типы нагрузки и их влияние**

### **1. Легкие пользователи (соцсети, почта)**

- Трафик: 50-200 КБ/с
    
- RAM: 15 МБ/клиент
    
- **Предел: 40-50 пользователей**
    

### **2. Средние (веб-серфинг, VoIP)**

- Трафик: 500 КБ-1 МБ/с
    
- RAM: 20 МБ/клиент
    
- **Предел: 25-30 пользователей**
    

### **3. Тяжелые (стриминг, торренты)**

- Трафик: 2-10 МБ/с
    
- RAM: 25-30 МБ/клиент
    
- **Предел: 10-15 пользователей**
    

## **Реальные тесты на разных VPS**

### **DigitalOcean 1GB / 1 CPU:**

- 10 клиентов: стабильно 50 Мбит/с
    
- 15 клиентов: 30 Мбит/с, ping 80мс
    
- 20 клиентов: начинается swap, лаги
    

### **Linode 1GB:**

- Результаты аналогичные
    
- SSD помогает при swapping
    

### **AWS t3.micro (1GB):**

- Хуже из-за burst CPU
    
- 8-12 клиентов максимум
    

## **Рекомендации по увеличению лимитов**

### **Срочные меры:**

1. **Добавить swap (если SSD):**
    

bash

sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

2. **Использовать WireGuard вместо OpenVPN:**
    

- Память: 5-10 МБ на клиент вместо 20-25 МБ
    
- CPU: на 50% меньше
    
- **Результат: 2-3 раза больше клиентов**
    

3. **Ограничить скорость на клиента:**
    

ini

# В server.conf
push "setenv opt outbound 2048"  # 2 Мбит/с на клиента

## **Практические примеры**

### **Сценарий 1: Офис 15 человек**

- Веб-почта, CRM, 1С
    
- **1 ГБ RAM достаточно** с запасом
    
- Проблем не будет
    

### **Сценарий 2: Публичный VPN-сервис**

- 20+ случайных пользователей
    
- **Требуется минимум 2 ГБ RAM**
    
- Или переход на WireGuard
    

### **Сценарий 3: Игровой сервер + VPN**

- 5-8 игроков максимум
    
- Иначе лаги в игре
    

## **Мониторинг и автоматизация**

### **Скрипт проверки нагрузки:**

bash

#!/bin/bash
CLIENTS=$(cat /etc/openvpn/openvpn-status.log | grep "10.8.0" | wc -l)
MEM_PER=$(ps -C openvpn -o rss | awk 'NR>1 {sum+=$1} END {print sum/1024}')
echo "Клиенты: $CLIENTS"
echo "Память OpenVPN: ${MEM_PER} МБ"
echo "Свободно RAM: $(free -m | awk 'NR==2 {print $4}') МБ"

if [ $(free -m | awk 'NR==2 {print $4}') -lt 100 ]; then
    echo "ВНИМАНИЕ: Мало памяти!"
fi

### **Когда точно будут проблемы:**

1. **Swap usage > 500 МБ** — уже плохо
    
2. **Load average > 2.0** — процессор не справляется
    
3. **Ping > 200 мс** у нескольких клиентов
    

## **Выводы и конкретные цифры**

### **Безопасные лимиты для 1 ГБ VPS:**

- **OpenVPN: 12-18 одновременных клиентов**
    
- **WireGuard: 25-40 клиентов**
    
- **IPSec: 8-12 клиентов**
    

### **Порог заметного замедления:**

- Для OpenVPN: **после 8-10 клиентов**
    
- Для WireGuard: **после 20 клиентов**
    

### **Рекомендация:**

Если нужно **более 15 постоянных пользователей** — берите VPS с **2 ГБ RAM** или переходите на **WireGuard**. Для 20+ пользователей уже нужен минимум **2 ядра CPU и 2-4 ГБ RAM**.

**Текущая конфигурация оптимальна для:**

- Маленького офиса (до 15 человек)
    
- Персонального использования с друзьями (до 10 человек)
    
- Резервного канала связи