# SERIAL последовательный тип
В [[PostgreSQL]] нет такой штуки как `AUTO_INCREMENT`. Для создания столбца с последовательным увеличением значения надо создать последовательность, а затемпри создании столбца таблицы указать эту последовательность в качестве дефолтного значения:

```
CREATE SEQUENCE _`имя_таблицы`___`имя_столбца`__seq AS integer;
CREATE TABLE _`имя_таблицы`_ (
    _`имя_столбца`_ integer NOT NULL DEFAULT nextval('_`имя_таблицы`___`имя_столбца`__seq')
);
ALTER SEQUENCE _`имя_таблицы`___`имя_столбца`__seq OWNED BY _`имя_таблицы`_._`имя_столбца`_;
```

Причём дополнительно нужно указать `NOT NULL` и `PRIMARY KEY` если это нужно. Последняя команда определяет, что последовательность «принадлежит» столбцу, так что она будет удалена при удалении столбца или таблицы.

Гораздо более элегантный способ - это использовать тип `SERIAL`
```
CREATE TABLE _`имя_таблицы`_ (
    _`имя_столбца`_ SERIAL
);
```

>При использовании `SERIAL` во многих случаях также имеет смысл добавить для этого столбца ограничения `UNIQUE` или `PRIMARY KEY` для защиты от ошибочного добавления дублирующихся значений, но автоматически это не происходит


[Подробнее здесь](https://postgrespro.ru/docs/postgresql/14/datatype-numeric#DATATYPE-SERIAL)

### Последовательность
Если создана последовательность ([как в этом примере](https://www.postgresql.org/docs/current/sql-createsequence.html)) то, чтобы получить следующее значение можно использовать запрос:
```sql
SELECT nextval('sequence_name');
```
где `sequence_name` это название последовательности. Вывести список последовательностей можно командой для psql `\d`

Запрос выше увеличит счётчик на 1 и вернёт последнее значение. Если нужно запросить последнее значение последовательности без увеличения счётчика, то можно сделать такой запрос:

```sql
SELECT currval('sequence_name');
```

##### Особенность
Использование запроса `SELECT currval('sequence_name')` зависит от сеанса. Это означает, что если подключиться к БД и попробовать получить текущее значение какой-либо последовательности, то это не сработает. Такой запрос упадёт с ошибкой. Чтобы получить значение нужно либо сделать запрос с командой на увеличение счётчика `nextval`, либо выполнить запрос типа `insert into...` .

Интересно, что если есть 2 сеанса (сеанс1 и сеанс 2), при этом сеанс1 добавляет запись и `currval` возвращает ему (к примеру) значение 5, а после этого сеанс2 увеличивает значение последовательности командой `insert into...` или `nextval`, то для сеанса1 `currval` вернёт 5 (старое значение).

Вывод: каждый сеанс запоминает последнее значение последовательности и обновляет это значение только в случае изменения последовательности.
