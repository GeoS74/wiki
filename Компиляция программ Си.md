
# Компиляция программ Си


### Компиляция

В общем процесс компиляции программ на [[Си]] в упрощённом виде сводится к 2-м этапам:
1) создание объектных файлов с расширением `.o`;
2) линковка в исполняемый файл.

Пример: есть два файла `main.c` и `any.c`, следующая команда создаст 2 объектных файла:

```bash
gcc -c main.c any.c # можно по отдельности для каждого файла
```

Линковка и сборка исполняемого файла, следующая команда создаст файл `a.out`:

```bash
gcc main.o any.o
```

Можно указать имя итогового файла:

```bash
gcc -o app main.o any.o
```

Можно объединить эти два этапа и создать сразу исполняемый файл:

```bash
gcc -o app main.c any.c # для нескольких файлов

gcc main.c -o app # для одного файла
```

### Динамическая и статическая линковка

```bash
gcc app.c -o app # динамическая линковка

gcc -static app.c -o app # статическая линковка
```

При использовании статической линковки размер файла в разы больше, чем при динамической. 
При статической линковке (`-static`) в исполняемый файл попадёт только тот код библиотеки, который реально используется. Линкер анализирует, какие функции вызваны в программе, и забирает из библиотеки только их объектные файлы. Это означает, что если в программе используется только `printf()` из `stdio.h` линкер возьмёт из `libc.a` объектный файл, содержащий `printf`, и всё, что `printf` вызывает внутри себя (например, `puts`, `write` и т.д.). Но не возьмёт `scanf`, `fopen`, `strcpy` и прочее.


### Базовые флаги компилятора

`-o <file>` - задать имя выходного файла
`-c` - только компиляция (без линковки)
`-Wall` - включить все основные предупреждения
`-Wextra` - включить дополнительные предупреждения
`-Werror` - превратить предупреждения в ошибки
`-g` - добавить отладочную информацию (для gdb)
`-O0`, `-O1`, `-O2`, `-O3` - уровни оптимизации
`-std=c89`, `-std=c99`, `-std=c11` - выбрать стандарт языка
`-I<path>` - добавить путь для заголовочных файлов
`-L<path>` - добавить путь для библиотек
`-l<name>` - подключить библиотеку (например, `-lm` для math)
`-static` - статическая линковка
`-v` - показать подробный вывод компилятора
`-E` - только препроцессинг
`-S` - только ассемблерный код


Примеры:
```bash
gcc -c -Wall -Wextra main.c           # компиляция с предупреждениями
gcc -o prog main.o -lm                # линковка с математической библиотекой
gcc -g -O0 main.c -o debug            # отладочная версия без оптимизации
gcc -std=c99 -Wall -Werror main.c     # строгий режим
gcc -S main.c                        # создаст main.s (ассемблер)
```

#gcc #компиляция