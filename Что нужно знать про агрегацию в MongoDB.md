# Что нужно знать про агрегацию в MongoDB

1) Агрегация в [[MongoDB]] это не магия.
2) Максимально используй индексы для оптимизации поиска.
3) Если используется `lookup` для присоединения данных из другой коллекции, выполни все `match` условия выборки до использования `lookup`.
4) Если предполагается поиск по полям из целевой коллекции и из присоединённой, то используй `pipeline` внутри `lookup` - это сильно оптимизирует запрос.
5) По возможности все `lookup` должны быть в конце агрегации, после максимального сужения количества документов в выборке.
6) используй `limit` как можно раньше.
7) используй `Doc.aggregate(pipeline).explain("executionStats")`, чтобы узнать как выполняется запрос.