
# 504 bad gateway

Ошибка 504 возникает когда [[Nginx]] работает как прокси. Для решения проблемы можно в блок `server` вставить такие строки, это увеличит время ожидания до 600 секунд:

```
proxy_connect_timeout 600;
proxy_send_timeout 600;
proxy_read_timeout 600;
send_timeout: 600;
```

`proxy_connect_timeout` - Определяет тайм-аут для установления соединения с проксируемым сервером. Следует отметить, что этот тайм-аут обычно не может превышать 75 секунд.

`proxy_send_timeout` - Устанавливает тайм-аут для передачи запроса на проксируемый сервер. Тайм-аут устанавливается только между двумя последовательными операциями записи, не для передачи всего запроса. Если проксируемый сервер ничего не получает в течение этого времени, соединение закрыто.

`proxy_read_timeout` - Определяет время ожидания для чтения ответа от проксируемого сервера. Тайм-аут устанавливается только между двумя последовательными операциями чтения, не для передачи всего ответа. Если проксируемый сервер ничего не передает в течение этого времени, соединение закрыто.

`send_timeout` - Устанавливает тайм-аут для передачи ответа клиенту. Тайм-аут устанавливается только между двумя последовательными операциями записи, не для передачи всего ответа. Если клиент ничего не получит в течение этого времени, соединение закрыто.

Пример [[Конфигурация nginx | конфигурации]]:

```
server {
  listen 80;
  server_name localhost;

  location / {
    root   /usr/share/nginx/html;
    try_files $uri /index.html;
  }

  location /api/bridge/ {
    proxy_pass http://${HOST_BRIDGE}:${PORT_BRIDGE};
	proxy_connect_timeout 600;
	proxy_send_timeout 600;
	proxy_read_timeout 600;
  }
}
```


[Решение подсмотрено здесь](https://losst.pro/kak-ispravit-504-gateway-time-out-nginx)

[Подробнее про директивы ngx_http_proxy_module](http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_read_timeout)

[Подробнее про директивы ngx_http_core_module](http://nginx.org/en/docs/http/ngx_http_core_module.html)


#nginx